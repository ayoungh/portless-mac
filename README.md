# Portless Menu (macOS)

Menu bar utility for running `package.json` scripts (with Portless scripts highlighted), naming runs, and monitoring active Portless processes.

## Project Scope

- This project is an independent wrapper around the `portless` CLI.
- It does not bundle or vendor Portless source code.
- It executes the Portless binary already installed on the user's machine.

Upstream Portless project: [vercel-labs/portless](https://github.com/vercel-labs/portless)

## Features

- Open any project folder from the menu bar.
- Save and reuse recent folders across app launches.
- Parse `package.json` and load available scripts.
- Filter scripts by name or command text.
- Highlight likely Portless scripts.
- Detect first-time setup state for Portless:
  - checks local dependency (`portless` or `@vercel-labs/portless`) in `package.json`
  - checks global CLI availability (`command -v portless`)
- Install Portless from the app when missing (uses `pnpm add -g portless`, `yarn global add portless`, or `npm install -g portless`).
- Choose a custom run name and start the script.
- Track scripts launched by this app and show discovered external `portless` processes.
- Extract and display runtime metadata where available:
  - detected URLs
  - detected ports
  - last observed log line (for managed processes)
- Open detected URLs directly in your browser.
- Stop managed or external processes from the UI.
- Configure proxy startup from the UI:
  - custom proxy port
  - HTTPS mode
  - disable TLS to backend
  - custom TLS cert/key paths
- Restart proxy and trust local CA from the UI (`portless trust` via admin prompt).
- Show parsed routes with quick-open actions.
- Show all detected app URLs (not just the first URL).
- Show proxy diagnostics for common misconfigurations.
- Copy proxy start command and detected URLs from the UI.

## Run

```bash
swift build
swift run PortlessMenu
```

The app appears in your macOS menu bar as `Portless`.

## Install

### Prerequisites

- macOS 13 or newer
- Xcode Command Line Tools
  ```bash
  xcode-select --install
  ```

### Option 1: Run from source (no install)

```bash
cd /path/to/portless-mac
swift run PortlessMenu
```

### Option 2: Build release binary

```bash
cd /path/to/portless-mac
swift build -c release
```

Binary output:

`/path/to/portless-mac/.build/release/PortlessMenu`

### Option 3: Package a real `.app` bundle (recommended)

```bash
cd /path/to/portless-mac
./scripts/package_app.sh
open ./dist/PortlessMenu.app
```

Bundle output:

`/path/to/portless-mac/dist/PortlessMenu.app`

This bundle is generated by `scripts/package_app.sh` and is the recommended way to run if `swift run` is unreliable.

### Option 4: Install for your user

```bash
mkdir -p ~/Applications
cp -R /path/to/portless-mac/dist/PortlessMenu.app ~/Applications/PortlessMenu.app
open ~/Applications/PortlessMenu.app
```

You can then launch it from Spotlight by searching `PortlessMenu`.

### Start automatically on login

1. Open System Settings.
2. Go to `General` -> `Login Items`.
3. Under `Open at Login`, add `~/Applications/PortlessMenu`.

### Uninstall

```bash
rm -f ~/Applications/PortlessMenu
```

Also remove it from `Login Items` if you added it there.

### First-time Portless setup

- The app checks whether the Portless CLI exists.
- If missing, use the in-app `Install Portless` button.
- The installer will run one of:
  - `pnpm add -g portless`
  - `yarn global add portless`
  - `npm install -g portless`

If global install permissions are restricted on your machine, run one of those commands manually with appropriate permissions.

### Troubleshooting

- If the app does not appear in the menu bar, fully quit and relaunch `PortlessMenu`.
- If scripts do not load, confirm the selected folder has a valid `package.json`.
- If no running Portless apps are shown, ensure your command line includes `portless` and click `Refresh`.

## Notes

- Package manager is auto-detected by lockfile (`pnpm-lock.yaml`, `yarn.lock`, fallback `npm`) for running project scripts.
- External process detection uses `ps` and filters command lines containing `portless`.
- URL/port extraction is heuristic and depends on process command/log output format.

## Open Source

- License: Apache-2.0 (`LICENSE`)
- Notices: `NOTICE`
- Contributions: `CONTRIBUTING.md`

## Attribution

- Portless is developed by Vercel Labs and licensed under Apache-2.0:
  [https://github.com/vercel-labs/portless](https://github.com/vercel-labs/portless)
